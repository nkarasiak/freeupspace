<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>From Up There</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>🛰️</text></svg>" />
    <link rel="stylesheet" href="/src/styles/main.css" />
  </head>
  <body>
    
    <!-- Main Map View -->
    <div id="map"></div>
    
    <!-- Show Cockpit Button (appears when cockpit is hidden) -->
    <button id="show-cockpit-btn" class="show-cockpit-btn" title="Show Cockpit (C)" style="display: none;">
      <span>🎛️</span>
      <span class="show-btn-text">COCKPIT</span>
    </button>

    <!-- Command Palette -->
    <div id="command-palette" class="command-palette">
      <div class="command-palette-content">
        <input 
          type="text" 
          id="command-input" 
          class="command-input" 
          placeholder="Type a command..."
          autocomplete="off"
          spellcheck="false"
        />
        <div id="command-results" class="command-results">
          <!-- Command items will be populated here -->
        </div>
      </div>
    </div>

    <!-- Command Palette Hint -->
    <div id="command-hint" class="command-hint">
      Press <span class="command-shortcut">/</span> to search satellites
    </div>
    
    <!-- Simple Top Banner -->
    <div id="cockpit-panel">
      <!-- Single Line Banner Layout -->
      <div id="banner-display">
        <!-- Altitude -->
        <div class="banner-item">
          <span class="banner-icon">📐</span>
          <span class="banner-label">Alt</span>
          <span class="banner-value"><span id="tracked-altitude">---</span><span class="banner-unit">km</span></span>
        </div>
        
        <div class="banner-separator"></div>
        
        <!-- Tracking (Clickable) -->
        <div class="banner-item tracking" data-section="search" title="Click to search satellites (or press /)">
          <span class="banner-icon">🎯</span>
          <span class="banner-label">Tracking</span>
          <span class="tracking-name" id="tracked-name">No satellite selected</span>
        </div>
        
        <div class="banner-separator"></div>
        
        <!-- Speed -->
        <div class="banner-item">
          <span class="banner-icon">⚡</span>
          <span class="banner-label">Speed</span>
          <span class="banner-value"><span id="tracked-speed">---</span><span class="banner-unit">km/s</span></span>
        </div>
      </div>
      
      <!-- Search Dropdown (Replaced with Command Palette) -->
      <div class="section-content" id="search-content" style="display: none;">
        <input type="text" id="satellite-search" placeholder="Search satellites..." />
        <div id="search-results"></div>
      </div>
    </div>
    
    <script type="module" src="/src/main.ts"></script>
    
    <script>
      // Modal dropdown functionality for cockpit sections
      document.addEventListener('DOMContentLoaded', function() {
        const sectionTitles = document.querySelectorAll('.section-title[data-section]');
        let activeDropdown = null;
        
        // Close dropdown function
        function closeDropdown(dropdown, title) {
          if (dropdown && title) {
            dropdown.classList.remove('active');
            title.classList.remove('active');
          }
          activeDropdown = null;
        }
        
        // Close all dropdowns
        function closeAllDropdowns() {
          sectionTitles.forEach(title => {
            const sectionName = title.dataset.section;
            const content = document.getElementById(sectionName + '-content');
            closeDropdown(content, title);
          });
        }
        
        // Handle section title clicks (existing dropdown buttons)
        sectionTitles.forEach(title => {
          title.addEventListener('click', function(e) {
            e.stopPropagation();
            const sectionName = this.dataset.section;
            const content = document.getElementById(sectionName + '-content');
            
            if (content) {
              // If this dropdown is already active, close it
              if (activeDropdown === content) {
                closeDropdown(content, this);
                return;
              }
              
              // Close any other open dropdown first
              closeAllDropdowns();
              
              // Open this dropdown
              content.classList.add('active');
              this.classList.add('active');
              activeDropdown = content;
              
              // Auto-focus search input if this is the search section
              if (sectionName === 'search') {
                // Use setTimeout to ensure the dropdown animation starts first
                setTimeout(() => {
                  const searchInput = document.getElementById('satellite-search');
                  if (searchInput) {
                    searchInput.focus();
                  }
                }, 100);
              }
            }
          });
        });

        // Tracking item click is now handled by CockpitComponent in TypeScript

        // No additional gauge functionality needed for now
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          // Don't close if clicking inside an active dropdown
          if (activeDropdown && activeDropdown.contains(e.target)) {
            return;
          }
          
          // Don't close if clicking on a banner item with data-section
          if (e.target.closest('.banner-item[data-section]')) {
            return;
          }
          
          // Close any open dropdown
          closeAllDropdowns();
        });
        
        // Close dropdown on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && activeDropdown) {
            closeAllDropdowns();
          }
        });
        
        // Prevent dropdown content clicks from bubbling up
        document.querySelectorAll('.section-content').forEach(content => {
          content.addEventListener('click', function(e) {
            e.stopPropagation();
          });
        });
        
      });
    </script>
  </body>
</html>